# 存储类别、链接和内存
## 一、定义（所说‘对象’均指内存空间）
### 1. 作用域
  - 块作用域
  - { }涵盖的区域
    - 包括函数的型参
    - 声明在函数内部的变量
  - 函数作用域
    - 仅作用与goto语句的标签
  - 函数原型作用域
    - 从形参定义到原型声明结束
  - 文件作用域
    - 变量的定义在函数的外面，具有文件作用域
    - 从定义处到该定义所在文件末尾均可见（全局变量）
### 2. 链接
C变量有3种链接属性：
  - 内部链接
  - 外部链接
  - 无链接
#### 内部链接 (文件作用域)
  static
  1. 仅限于一个翻译单元（源代码文件和它包含的头文件）的作用域
     1. 全局 static int 属于文件私有

#### 外部链接（全局作用域/程序作用域）
  1. 可延伸至其它翻译单元（源代码文件和它包含的头文件）的作用域
  2. 该文件和用一程序的其它文件都可以使用的变量
#### 无链接
  1. 块作用域、函数作用域或函数原型作用域的变量
### 3.存储期间
C对象有4种存储期
 - 静态存储期
 - 线程存储期
 - 自动存储期
 - 动态分配存储期

#### 静态存储期
  1. **程序运行期间一直存在**
  2. 函数中可以声明静态属性（static）
  3. 文件作用域变量的静态属性（static）仅表面链接属性，而非存储期
  4. 无论内部链接（static）还是外部链接，具有文件作用域的变量都具有静态存储期
#### 线程存储期
  1. **从声明到线程结束一直存在**
  2. 关键字 _Thread_local 声明对象时，每个线程都获得该变量的私有备份
  3. 
#### 自动存储期
  1. **块作用域的变量（函数内参数）通常都有自动存储期**
  2. **程序进入块作用域时分配内存，退出块时释放内存**
  3. 例如： 一个函数调用结束后，其变量占用的内存，可用于储存下一个被调用的函数变量内存（擦出重复使用）
#### 动态分配存储期
·····
### 4.块作用域的静态变量
静态变量
  - 意思是该变量在内存中的位置原地不动
  - 具有‘文件作用域’的变量自动具有’静态存储期‘
  - 具有块作用域、无链接$$
  - **离开所在函数后，变量不会消失，计算机在多次函数调用直接回记录它们的值**


### 5.外部链接的静态变量
#### extern
  - 文件作用域、外部链接和、态存储期
  - 称为外部变量（external variable）或者 外部存储类别
  - **作用于 其他翻译单元（源代码文件和它包含的头文件）**
  - **将变量的声明放在所以函数外面（不使用static）**
  - **可以使用关键字extern再次引用(或者不引用，直接调用)**
  
#### 初始化外部变量
  - 如果未初始化外部变量，会被**初始化为0**
  - 只能使用**常量表达式初始化** 文件作用域变量

#### 使用外部变量
  [使用外部变量.c](12-4.c)
  - 可以忽略 extern 声明 
 
#### 定义和声明
  - 外部变量只能初始化一次，且必须在定义该变量时进行
  
### 6.内部链接的静态变量
static
  - 静态存储期、文件作用域、内部链接
  - 在所有函数外部，用内存类别说明符 static 定义的变量
  - **只作用与 同一文件中的函数**
  - **可以使用关键字extern再次引用(或者不引用，直接调用)**

### 7.多文件
  - 如果外部变量定义在一个文件中，其他文件使用时必须先 extern 声明
  - **将两个文件共同编译**
  [parta.c](12-5.c)
  [partb.c](12-6.c)
      - （块作用域{ } 的）静态变量 subtotal: 统计每次 while 循环传入的 accumulate() 总值 
      - （文件作用域.c 的）静态变量 publicTotal: 统计所有传入 accmulate() 的总值
      -  外部变量 gameCount: 统计 while 的迭代次数

## 二、随机函数和静态变量
### 1.随机函数
#### 伪随机数  
  - 伪随机数生成 rand( )
    - 是指生成的数字可预测，但数字在其取值范围内均匀分布
  - 程序重新开始时，初始化值都为相同的‘种子’
  - [伪随机数函数](12-7.h)
    - [驱动文件.c](12-8.c)
  - [srand() 和 rand() 函数](12-9.h)
    - [驱动文件.c](12-10.c)

### 2. 静态变量
## 三、掷骰子
  - 头文件[diceroll.h](diceroll.h)
  - 驱动文件[12-13.c](12-13.c)
  - 为了公平，必须保证每个面出现的概率是1/6
    - [【C语言入门12.8 - 掷骰子的练习 (使用函数)](https://www.bilibili.com/video/BV1s8411L7K3/?share_source=copy_web&vd_source=4145b34856f70b75f02e15246eef0fbf)

## 四、分配内存
### malloc() 和 free() 
[[C语言]macllo定义 - 知乎](https://zhuanlan.zhihu.com/p/105090421)
  - 如果 malloc 分配成功，返回指向新分配内存的指针
  - 如果 malloc **分配失败，将会返回*空指针***
  - 即使size为零，malloc也是可以定义的，但不应当解引用这种指针（属于可选类型），应当传递给free以避免内存泄露
### 注意事项
  - maclloc 内的参数是需要动态分配的字节数，而不是可以存储的元素个数
  - 当动态分配内存时，存储的是字符型数据，每个字符1字节，所以字节数刚好等于需要存储的元素个数（字符数+1）
  - 如果存储的是整形或浮点型数据，字节数等于“需要存储的元素个数”一个元素的字节数，代码格式：
  
    ` type *var_name = (type *)malloc(sizeof(type) * num)`;
    - sizeof(type) 代表数组中每个元素的类型
    - num 代表数组的元素个数 == arr[N]
  - [malloc演示](malloc.c)

### 程序说明 [12-14.c](12-14.c)

  - 通过以下代码获取数组的大小
    ` if (scanf("%d",&max) != 1 || max == 0){`
    `   puts("输入不正确.");`
    `   exit(EXIT_FAILURE);`
    `}`
  - malloc 分配内存空间，并赋值给指针 ptd
    `ptd = (double *)malloc(max * sizeof(double));`
      - (double *) 表示强制类型转换
      - max 代表数组最大元素
      - sizeof(double) 代表元素类型
  - 如果是空指针（或者**分配不到所需的内存**）
    ` if (ptd == NULL)......`
  - 释放申请的内存
    ` free(ptd);`
### 
